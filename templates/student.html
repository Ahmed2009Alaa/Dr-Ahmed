<!DOCTYPE html>
<html lang="ar" dir="rtl">

<head>
    <meta charset="UTF-8">
    <title>Ø§Ù„Ø·Ø§Ù„Ø¨ - Ù…Ù†ØµØ© Ø§Ù„Ø¹Ù…ÙŠØ¯</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
    <style>
        .hidden {
            display: none;
        }

        .tab-button.active {
            background-color: #eee;
            font-weight: bold;
        }

        .lecture-item,
        .exam-item {
            margin-bottom: 20px;
            padding: 10px;
            border: 1px solid #ccc;
            border-radius: 10px;
        }
    </style>
</head>

<body>
    <div class="student-container">
        <h1>ğŸ‘¨â€ğŸ“ Ù…Ø±Ø­Ø¨Ù‹Ø§ Ø¨Ùƒ ÙÙŠ Ù…Ù†ØµØ© Ø§Ù„Ø¹Ù…ÙŠØ¯</h1>

        <div class="tabs">
            <button class="tab-button active" onclick="showTab('lectures')">ğŸ“š Ø¯Ø±ÙˆØ³Ùƒ</button>
            <button class="tab-button" onclick="showTab('exams')">ğŸ“ Ø§Ù…ØªØ­Ø§Ù†Ø§ØªÙƒ</button>
            <button class="tab-button" onclick="showTab('notes')">ğŸ“© Ù…Ù„Ø§Ø­Ø¸Ø§Øª Ø§Ù„Ù…Ø¹Ù„Ù…</button>
        </div>

        <!-- Ø§Ù„Ù…Ø­Ø§Ø¶Ø±Ø§Øª -->
        <div id="lectures" class="tab-content">
            <div id="studentLecturesList">â³ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¯Ø±ÙˆØ³...</div>
        </div>

        <!-- Ø§Ù„Ø§Ù…ØªØ­Ø§Ù†Ø§Øª -->
        <div id="exams" class="tab-content hidden">
            <div id="studentExamsList">â³ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø§Ù…ØªØ­Ø§Ù†Ø§Øª...</div>
        </div>

        <!-- Ø§Ù„Ù…Ù„Ø§Ø­Ø¸Ø§Øª -->
        <div id="notes" class="tab-content hidden">
            <p>ğŸ“¢ Ø³ÙŠØªÙ… Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ù…Ù„Ø§Ø­Ø¸Ø§Øª Ù‡Ù†Ø§ Ù‚Ø±ÙŠØ¨Ù‹Ø§ (ØªØ¬Ø±ÙŠØ¨ÙŠ)</p>
        </div>
    </div>

    <script>
        const grade = parseInt("{{ session.get('grade', 0) }}");

        function showTab(id) {
            document.querySelectorAll(".tab-content").forEach(div => div.classList.add("hidden"));
            document.getElementById(id).classList.remove("hidden");
            document.querySelectorAll(".tab-button").forEach(btn => btn.classList.remove("active"));
            event.target.classList.add("active");
        }

        function loadStudentLectures() {
            fetch("/get_lectures")
                .then(res => res.json())
                .then(data => {
                    const list = document.getElementById("studentLecturesList");
                    list.innerHTML = "";

                    const filtered = data.lectures.filter(lec => lec.grade == grade);

                    if (filtered.length === 0) {
                        list.innerHTML = "<p>â— Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¯Ø±ÙˆØ³ Ø­Ø§Ù„ÙŠØ§Ù‹.</p>";
                        return;
                    }

                    filtered.forEach(lec => {
                        const div = document.createElement("div");
                        div.className = "lecture-item";
                        div.innerHTML = `
                            <h3>${lec.title}</h3>
                            <video controls width="100%">
                                <source src="/uploads/${lec.filename}" type="video/mp4">
                            </video>
                            <hr />
                        `;
                        list.appendChild(div);
                    });
                });
        }

        function loadStudentExams() {
            fetch("/get_exams")
                .then(res => res.json())
                .then(data => {
                    const list = document.getElementById("studentExamsList");
                    list.innerHTML = "";

                    const filtered = data.exams.filter(ex => ex.grade == grade);

                    if (filtered.length === 0) {
                        list.innerHTML = "<p>â— Ù„Ø§ ØªÙˆØ¬Ø¯ Ø§Ù…ØªØ­Ø§Ù†Ø§Øª Ø­Ø§Ù„ÙŠØ§Ù‹.</p>";
                        return;
                    }

                    filtered.forEach(ex => {
                        const div = document.createElement("div");
                        div.className = "exam-item";
                        div.innerHTML = `
                            <h3>${ex.title}</h3>
                            <a href="/uploads/${ex.filename}" target="_blank">ğŸ“„ ÙØªØ­ Ø§Ù„Ø§Ù…ØªØ­Ø§Ù†</a>
                            <hr />
                        `;
                        list.appendChild(div);
                    });
                });
        }

        window.onload = () => {
            loadStudentLectures();
            loadStudentExams();
        };
    </script>
</body>

</html>