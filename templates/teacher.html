<!DOCTYPE html>
<html lang="ar" dir="rtl">

<head>
    <meta charset="UTF-8" />
    <title>ููุญุฉ ุชุญูู ุงููุนูู</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}" />
</head>

<body>
    <div class="teacher-container">
        <h1>๐จโ๐ซ ููุญุฉ ุชุญูู ุงููุนูู</h1>

        <!-- Tabs -->
        <div class="tabs">
            <button class="tab-button active" onclick="showTab('upload')">๐ค ุฑูุน ุฏุฑุณ</button>
            <button class="tab-button" onclick="showTab('videos')">๐ ุงููุญุงุถุฑุงุช</button>
            <button class="tab-button" onclick="showTab('add_student')">โ ุฅุถุงูุฉ ุทุงูุจ</button>
            <button class="tab-button" onclick="showTab('exam')">๐ ุฅุถุงูุฉ ุงูุชุญุงู</button>
        </div>

        <!-- ุฑูุน ุฏุฑุณ -->
        <div id="upload" class="tab-content">
            <form id="uploadLectureForm">
                <input type="text" id="lectureTitle" placeholder="ุนููุงู ุงูุฏุฑุณ" required />
                <select id="lectureGrade">
                    <option value="1">ุงูุตู ุงูุฃูู</option>
                </select>
                <input type="file" id="lectureFile" accept="video/*" required />
                <button type="submit" class="btn">ุฑูุน</button>
            </form>
        </div>

        <!-- ุนุฑุถ ุงูููุฏูููุงุช -->
        <div id="videos" class="tab-content hidden">
            <div id="lectureList"></div>
        </div>

        <!-- ุฅุถุงูุฉ ุทุงูุจ -->
        <div id="add_student" class="tab-content hidden">
            <form id="addStudentForm">
                <input type="text" id="studentUsername" placeholder="ุงุณู ุงููุณุชุฎุฏู" required />
                <input type="password" id="studentPassword" placeholder="ูููุฉ ุงููุฑูุฑ" required />
                <select id="studentGrade">
                    <option value="1">ุงูุตู ุงูุฃูู</option>
                </select>
                <button type="submit" class="btn">ุฅุถุงูุฉ</button>
            </form>
        </div>

        <!-- ุฅุถุงูุฉ ุงูุชุญุงู -->
        <div id="exam" class="tab-content hidden">
            <form id="examForm">
                <input type="text" id="examTitle" placeholder="ุนููุงู ุงูุงูุชุญุงู" required />
                <select id="examGrade">
                    <option value="1">ุงูุตู ุงูุฃูู</option>
                </select>
                <input type="file" id="examFile" accept=".pdf,.docx" required />
                <button type="submit" class="btn">ุฑูุน ุงูุงูุชุญุงู</button>
            </form>
        </div>

        <div id="message" class="fade-message"></div>
    </div>

    <script>
        function showTab(id) {
            document.querySelectorAll(".tab-content").forEach(div => div.classList.add("hidden"));
            document.getElementById(id).classList.remove("hidden");
            document.querySelectorAll(".tab-button").forEach(btn => btn.classList.remove("active"));
            event.target.classList.add("active");
        }

        // ุฑูุน ุฏุฑุณ
        document.getElementById("uploadLectureForm").onsubmit = function (e) {
            e.preventDefault();
            const formData = new FormData();
            formData.append("title", document.getElementById("lectureTitle").value);
            formData.append("grade", document.getElementById("lectureGrade").value);
            formData.append("video", document.getElementById("lectureFile").files[0]);

            fetch("/upload_lecture", {
                method: "POST",
                body: formData,
            })
                .then(res => res.json())
                .then(data => {
                    showMsg(data.message);
                    loadLectures();
                });
        };

        // ุฅุถุงูุฉ ุทุงูุจ
        document.getElementById("addStudentForm").onsubmit = function (e) {
            e.preventDefault();
            const body = {
                username: document.getElementById("studentUsername").value,
                password: document.getElementById("studentPassword").value,
                grade: document.getElementById("studentGrade").value
            };

            fetch("/add_student", {
                method: "POST",
                headers: { "Content-Type": "application/json" },
                body: JSON.stringify(body)
            })
                .then(res => res.json())
                .then(data => {
                    showMsg(data.message);
                });
        };

        // ุชุญููู ุงููุญุงุถุฑุงุช
        function loadLectures() {
            fetch("/get_lectures")
                .then(res => res.json())
                .then(data => {
                    const container = document.getElementById("lectureList");
                    container.innerHTML = "";
                    data.lectures.forEach(lec => {
                        const div = document.createElement("div");
                        div.className = "lecture-item";
                        div.innerHTML = `
              <h3>${lec.title} - ุงูุตู ${lec.grade}</h3>
              <video controls width="100%">
                <source src="/uploads/${lec.filename}" type="video/mp4" />
              </video>
              <button onclick="deleteLecture(${lec.id})" class="btn delete">๐๏ธ ุญุฐู</button>
              <hr />
            `;
                        container.appendChild(div);
                    });
                });
        }

        function deleteLecture(id) {
            if (!confirm("ูู ุฃูุช ูุชุฃูุฏ ูู ุญุฐู ูุฐุง ุงูุฏุฑุณุ")) return;
            fetch("/delete_lecture", {
                method: "POST",
                headers: { "Content-Type": "application/json" },
                body: JSON.stringify({ id })
            })
                .then(res => res.json())
                .then(data => {
                    showMsg(data.message);
                    loadLectures();
                });
        }

        function showMsg(msg) {
            const el = document.getElementById("message");
            el.textContent = msg;
            el.classList.add("show");
            setTimeout(() => el.classList.remove("show"), 3000);
        }

        // ุชุญููู ุงููุญุงุถุฑุงุช ุนูุฏ ูุชุญ ุงูุตูุญุฉ
        loadLectures();
    </script>
</body>

</html>